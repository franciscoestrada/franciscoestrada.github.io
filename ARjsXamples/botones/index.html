<!doctype HTML>
<html>
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
  <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>
  <!-- Script para fusionar im치genes en canvas  https://github.com/lukechilds/merge-images  -->
  <script src="https://unpkg.com/merge-images"></script>
  <script src="js/capture-video-frame.js"></script>
  
<style>
    .boton {
      background-color: #ffffff; 
      border: solid 2px #ccc;
      color: rgb(114, 114, 114);
      padding: 7px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 8px;
      font-weight: bold;
      margin: 4px 2px;
      cursor: pointer;
      border-radius: 5px;
      box-shadow: 0 8px 16px 0 rgba(0,0,0,0.5), 0 6px 20px 0 rgba(0,0,0,0.5); 
      
    }
.menu{
      position: fixed; 
      top: 10px; 
      left: 80%;
      width:10%; 
      height: 100%;
      text-align: right; 
      z-index: 1;
    }
    </style>
<body style='margin : 0px; overflow: hidden;'>
<div class='menu'>
    <button class="boton" id="btn1">Astronauta</button><br>
    <button class="boton" id="btn2">Isla</button><br>
    <button class="boton" id="btn3">Mariposa</button><br>
    <button class="boton" id="btn4">Nefertiti</button><br>
    
    <button class="boton" id="foto-button">Tomar Foto</button>
    <a id="descarga-link" href="#"></a>
</div>


    <a-scene embedded arjs="debugUIEnabled: false;" vr-mode-ui="enabled: false">  
   
    <a-marker preset="hiro">
       
        <a-entity 
        id="modelo" 
        gltf-model="modelos3d/silly-dancing.glb" 
        scale="0.5 0.5 0.5" 
        rotation="-90 0 0" 
        position="0 0 1"
        animation-mixer="loop: repeat"></a-entity>
        
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>

<!-- C칩digo para intercambiar los modelos 3D  -->
    <script>
      document.getElementById("btn1").addEventListener("click", (e)=>{
                    var el = document.querySelector('#modelo');
                    el.setAttribute("gltf-model", 'modelos3d/silly-dancing.glb');
                    el.setAttribute("rotation",'-90 0 0');
                    el.setAttribute("scale",'0.5 0.5 0.5');
})
        
     document.getElementById("btn2").addEventListener("click", (e)=>{
                    var el = document.querySelector('#modelo');
                    el.setAttribute("gltf-model", 'modelos3d/isla.glb');
                    el.setAttribute("rotation",'-90 0 0');
                    el.setAttribute("position",'0 0 -0.5');
                    el.setAttribute("scale",'5 5 5');
})
    
     document.getElementById("btn3").addEventListener("click", (e)=>{
                    var el = document.querySelector('#modelo');
                    el.setAttribute("gltf-model", 'modelos3d/mariposa.glb');
                    el.setAttribute("rotation",'-45 -45 0');
                    el.setAttribute("scale",'0.3 0.3 0.3');
                    el.setAttribute("position",'0 1 0');
})

     document.getElementById("btn4").addEventListener("click", (e)=>{
                    var el = document.querySelector('#modelo');
                    el.setAttribute("gltf-model", 'modelos3d/nefertiti.glb');
                    el.setAttribute("rotation",'-90 0 0');
                    el.setAttribute("scale",'.008 .008 .008');
                    el.setAttribute("position",'0 1.5 0');
})
</script>  

<!-- C칩digo para captura de pantalla  -->
<script>
  // Fusionar im치genes 
  function resizeCanvas(origCanvas, width, height) {
    let resizedCanvas = document.createElement("canvas");
    let resizedContext = resizedCanvas.getContext("2d");
 
    resizedCanvas.height = height;
    resizedCanvas.width = width;
 
    resizedContext.drawImage(origCanvas, 0, 0, width, height);
    return resizedCanvas.toDataURL();
}
 
document.getElementById("foto-button").addEventListener("click", function() {
    let aScene = document.querySelector("a-scene").components.screenshot.getCanvas("perspective");
    let frame = captureVideoFrame("video", "png");
    aScene = resizeCanvas(aScene, frame.width, frame.height);
    frame = frame.dataUri;
     
  mergeImages([frame, aScene]).then(b64 => {
        let link = document.getElementById("descarga-link", "jpeg");
        link.setAttribute("download", "FOTO.jpg");
        link.setAttribute("href", b64);
        link.click();
    console.log("foto tomada");
    });
});

// Captura de video
function captureVideoFrame(video, format, width, height) {
        if (typeof video === 'string') {
            video = document.querySelector(video);
        }
        format = format || 'jpeg';
 
        if (!video || (format !== 'png' && format !== 'jpeg')) {
            return false;
        }
        var canvas = document.createElement("CANVAS");
        canvas.width = width || video.videoWidth;
        canvas.height = height || video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        var dataUri = canvas.toDataURL('image/' + format);
        var data = dataUri.split(',')[1];
        var mimeType = dataUri.split(';')[0].slice(5)
 
        var bytes = window.atob(data);
        var buf = new ArrayBuffer(bytes.length);
        var arr = new Uint8Array(buf);
 
        for (var i = 0; i < bytes.length; i++) {
            arr[i] = bytes.charCodeAt(i);
        }
        var blob = new Blob([ arr ], { type: mimeType });
        return { blob: blob, dataUri: dataUri, format: format, width: canvas.width, height: canvas.height };
    };
  </script>
  </body>
</html>



